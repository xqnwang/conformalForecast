<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to conformalForecast • conformalForecast</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to conformalForecast">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">conformalForecast</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/conformalForecast.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/xqnwang/conformalForecast/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to conformalForecast</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/xqnwang/conformalForecast/blob/v0.1.1/vignettes/conformalForecast.Rmd" class="external-link"><code>vignettes/conformalForecast.Rmd</code></a></small>
      <div class="d-none name"><code>conformalForecast.Rmd</code></div>
    </div>

    
    
<p>The <em>conformalForecast</em> package provides some commonly used
conformal prediction methods for time series forecasting.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/xqnwang/conformalForecast" class="external-link">conformalForecast</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.robjhyndman.com/forecast/" class="external-link">forecast</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tsibble.tidyverts.org" class="external-link">tsibble</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="data-simulation">Data simulation<a class="anchor" aria-label="anchor" href="#data-simulation"></a>
</h2>
<p>Suppose we are interested in forecasting a time series data generated
from an AR(2) model with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mn>1</mn></msub><mo>=</mo><mn>0.8</mn></mrow><annotation encoding="application/x-tex">\phi_1 = 0.8</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϕ</mi><mn>2</mn></msub><mo>=</mo><mo>−</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">\phi_2=-0.5</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>σ</mi><mn>2</mn></msup><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sigma^2 = 1</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/arima.sim.html" class="external-link">arima.sim</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">series</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Time series generated from an AR(2) model"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">""</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="conformalForecast_files/figure-html/data-1.png" class="r-plt" alt="" width="672"></p>
</div>
<div class="section level2">
<h2 id="time-series-cross-validation">Time series cross-validation<a class="anchor" aria-label="anchor" href="#time-series-cross-validation"></a>
</h2>
<p>We first train a forecasting model AR(2) on a rolling forecast origin
to generate forecasts and forecast errors on validation sets.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">far2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">h</span>, <span class="va">level</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/Arima.html" class="external-link">Arima</a></span><span class="op">(</span><span class="va">x</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">h</span>, <span class="va">level</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cvforecast.html">cvforecast</a></span><span class="op">(</span><span class="va">series</span>, forecastfun <span class="op">=</span> <span class="va">far2</span>, h <span class="op">=</span> <span class="fl">3</span>, level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">95</span><span class="op">)</span>,</span>
<span>                 forward <span class="op">=</span> <span class="cn">TRUE</span>, window <span class="op">=</span> <span class="fl">100</span>, initial <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cross-validation</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt;  cvforecast(y = series, forecastfun = far2, h = 3, level = c(80,  </span></span>
<span><span class="co">#&gt;      95), forward = TRUE, initial = 1, window = 100) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  fit_times = 901 (the forward step included) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Forecasts of the forward step:</span></span>
<span><span class="co">#&gt;      Point Forecast     Lo 80    Hi 80     Lo 95    Hi 95</span></span>
<span><span class="co">#&gt; 1001      0.1430927 -1.317635 1.603821 -2.090898 2.377083</span></span>
<span><span class="co">#&gt; 1002     -0.3763649 -2.181868 1.429138 -3.137644 2.384914</span></span>
<span><span class="co">#&gt; 1003     -0.5230650 -2.328976 1.282846 -3.284968 2.238838</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cross-validation error measures:</span></span>
<span><span class="co">#&gt;        ME   MAE   MSE  RMSE    MPE   MAPE  MASE RMSSE Winkler_95 MSIS_95</span></span>
<span><span class="co">#&gt; CV -0.018 0.972 1.506 1.102 36.202 218.01 0.947 0.866      5.765   5.616</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fc</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Forecasts produced using an AR(2) model"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">""</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="conformalForecast_files/figure-html/cvplot-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">fc_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html" class="external-link">accuracy</a></span><span class="op">(</span><span class="va">fc</span>, byhorizon <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Winkler_95  MSIS_95</span></span>
<span><span class="co">#&gt; CV h=1   4.784124 4.659562</span></span>
<span><span class="co">#&gt; CV h=2   6.247227 6.090071</span></span>
<span><span class="co">#&gt; CV h=3   6.269019 6.105162</span></span>
<span><span class="op">(</span><span class="va">fc_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coverage.html">coverage</a></span><span class="op">(</span><span class="va">fc</span>, window <span class="op">=</span> <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       h=1       h=2       h=3 </span></span>
<span><span class="co">#&gt; 0.9544444 0.9421580 0.9354120</span></span>
<span><span class="op">(</span><span class="va">fc_wid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/width.html">width</a></span><span class="op">(</span><span class="va">fc</span>, window <span class="op">=</span> <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">95</span>, includemedian <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean width:</span></span>
<span><span class="co">#&gt;      h=1      h=2      h=3 </span></span>
<span><span class="co">#&gt; 3.915949 4.999164 5.049476 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Median width:</span></span>
<span><span class="co">#&gt;      h=1      h=2      h=3 </span></span>
<span><span class="co">#&gt; 3.885016 4.919813 4.957593</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conformal-prediction">Conformal prediction<a class="anchor" aria-label="anchor" href="#conformal-prediction"></a>
</h2>
<p>Based on the forecast errors on validation sets, we can train various
conformal prediction methods to obtain distribution-free uncertainty
estimation.</p>
<div class="section level3">
<h3 id="classical-split-conformal-prediction-scp">Classical split conformal prediction (SCP)<a class="anchor" aria-label="anchor" href="#classical-split-conformal-prediction-scp"></a>
</h3>
<p>Here, we perform a SCP method with equal weights in sample quantile
estimation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scpfc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scp.html">scp</a></span><span class="op">(</span><span class="va">fc</span>, symmetric <span class="op">=</span> <span class="cn">FALSE</span>, ncal <span class="op">=</span> <span class="fl">100</span>, rolling <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             weightfun <span class="op">=</span> <span class="cn">NULL</span>, kess <span class="op">=</span> <span class="cn">FALSE</span>, quantiletype <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">scpfc_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html" class="external-link">accuracy</a></span><span class="op">(</span><span class="va">scpfc</span>, byhorizon <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Winkler_95  MSIS_95</span></span>
<span><span class="co">#&gt; CV h=1   5.003118 4.830704</span></span>
<span><span class="co">#&gt; CV h=2   6.527138 6.302017</span></span>
<span><span class="co">#&gt; CV h=3   6.635156 6.403022</span></span>
<span><span class="op">(</span><span class="va">scpfc_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coverage.html">coverage</a></span><span class="op">(</span><span class="va">scpfc</span>, window <span class="op">=</span> <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       h=1       h=2       h=3 </span></span>
<span><span class="co">#&gt; 0.9500000 0.9473684 0.9396985</span></span>
<span><span class="op">(</span><span class="va">scpfc_wid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/width.html">width</a></span><span class="op">(</span><span class="va">scpfc</span>, window <span class="op">=</span> <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">95</span>, includemedian <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean width:</span></span>
<span><span class="co">#&gt;      h=1      h=2      h=3 </span></span>
<span><span class="co">#&gt; 4.114655 5.368746 5.403647 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Median width:</span></span>
<span><span class="co">#&gt;      h=1      h=2      h=3 </span></span>
<span><span class="co">#&gt; 4.054006 5.334842 5.326651</span></span></code></pre></div>
<p>The <code><a href="../reference/scp.html">scp()</a></code> function allows us to include non-equal
weights for sample quantile estimation by passing a weight calculation
function to the <code>weightfun</code> argument.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">expweight</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fl">0.99</span><span class="op">^</span><span class="op">{</span><span class="va">n</span><span class="op">+</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="va">scpfc_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scp.html">scp</a></span><span class="op">(</span><span class="va">fc</span>, symmetric <span class="op">=</span> <span class="cn">FALSE</span>, ncal <span class="op">=</span> <span class="fl">100</span>, rolling <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 weightfun <span class="op">=</span> <span class="va">expweight</span>, kess <span class="op">=</span> <span class="cn">FALSE</span>, quantiletype <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">scpfc_exp_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html" class="external-link">accuracy</a></span><span class="op">(</span><span class="va">scpfc_exp</span>, byhorizon <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Winkler_95  MSIS_95</span></span>
<span><span class="co">#&gt; CV h=1   5.108981 4.930413</span></span>
<span><span class="co">#&gt; CV h=2   6.563368 6.336281</span></span>
<span><span class="co">#&gt; CV h=3   6.615147 6.381920</span></span>
<span><span class="op">(</span><span class="va">scpfc_exp_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coverage.html">coverage</a></span><span class="op">(</span><span class="va">scpfc_exp</span>, window <span class="op">=</span> <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       h=1       h=2       h=3 </span></span>
<span><span class="co">#&gt; 0.9550000 0.9548872 0.9484925</span></span>
<span><span class="op">(</span><span class="va">scpfc_exp_wid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/width.html">width</a></span><span class="op">(</span><span class="va">scpfc_exp</span>, window <span class="op">=</span> <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">95</span>, includemedian <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean width:</span></span>
<span><span class="co">#&gt;      h=1      h=2      h=3 </span></span>
<span><span class="co">#&gt; 4.322785 5.567499 5.585576 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Median width:</span></span>
<span><span class="co">#&gt;      h=1      h=2      h=3 </span></span>
<span><span class="co">#&gt; 4.297306 5.455463 5.499007</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adaptive-conformal-prediction-acp">Adaptive conformal prediction (ACP)<a class="anchor" aria-label="anchor" href="#adaptive-conformal-prediction-acp"></a>
</h3>
<p>The ACP method uses an online update of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
to perform the calibration so that we can achieve either approximate or
exact marginal coverage.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acpfc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/acp.html">acp</a></span><span class="op">(</span><span class="va">fc</span>, symmetric <span class="op">=</span> <span class="cn">FALSE</span>, gamma <span class="op">=</span> <span class="fl">0.005</span>, ncal <span class="op">=</span> <span class="fl">100</span>, rolling <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">acpfc_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html" class="external-link">accuracy</a></span><span class="op">(</span><span class="va">acpfc</span>, byhorizon <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Winkler_95  MSIS_95</span></span>
<span><span class="co">#&gt; CV h=1   5.036517 4.863717</span></span>
<span><span class="co">#&gt; CV h=2   6.644759 6.416735</span></span>
<span><span class="co">#&gt; CV h=3   6.785646 6.551065</span></span>
<span><span class="op">(</span><span class="va">acpfc_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coverage.html">coverage</a></span><span class="op">(</span><span class="va">acpfc</span>, window <span class="op">=</span> <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       h=1       h=2       h=3 </span></span>
<span><span class="co">#&gt; 0.9487500 0.9498747 0.9497487</span></span>
<span><span class="op">(</span><span class="va">acpfc_wid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/width.html">width</a></span><span class="op">(</span><span class="va">acpfc</span>, window <span class="op">=</span> <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">95</span>, includemedian <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean width:</span></span>
<span><span class="co">#&gt;      h=1      h=2      h=3 </span></span>
<span><span class="co">#&gt; 4.119178 5.420955 5.635120 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Median width:</span></span>
<span><span class="co">#&gt;      h=1      h=2      h=3 </span></span>
<span><span class="co">#&gt; 4.034989 5.426268 5.499007</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="conformal-pid-control-pid">Conformal PID control (PID)<a class="anchor" aria-label="anchor" href="#conformal-pid-control-pid"></a>
</h3>
<p>The PID method combines three modules (quantile tracking, error
integration, and scorecasting) to make an iteration to produce a
sequence of quantile estimates used in the prediction sets.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># PID setup</span></span>
<span><span class="va">Tg</span> <span class="op">&lt;-</span> <span class="fl">1000</span>; <span class="va">delta</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span><span class="va">Csat</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">/</span> <span class="va">pi</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Tg</span><span class="op">)</span> <span class="op">*</span> <span class="va">delta</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Tg</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">KI</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">lr</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># PID without scorecaster</span></span>
<span><span class="va">pidfc_nsf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pid.html">pid</a></span><span class="op">(</span><span class="va">fc</span>, symmetric <span class="op">=</span> <span class="cn">FALSE</span>, ncal <span class="op">=</span> <span class="fl">100</span>, rolling <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 integrate <span class="op">=</span> <span class="cn">TRUE</span>, scorecast <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 lr <span class="op">=</span> <span class="va">lr</span>, KI <span class="op">=</span> <span class="va">KI</span>, Csat <span class="op">=</span> <span class="va">Csat</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">pidfc_nsf_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html" class="external-link">accuracy</a></span><span class="op">(</span><span class="va">pidfc_nsf</span>, byhorizon <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Winkler_95  MSIS_95</span></span>
<span><span class="co">#&gt; CV h=1   5.122446 4.948241</span></span>
<span><span class="co">#&gt; CV h=2   6.760180 6.529263</span></span>
<span><span class="co">#&gt; CV h=3   6.962396 6.718390</span></span>
<span><span class="op">(</span><span class="va">pidfc_nsf_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coverage.html">coverage</a></span><span class="op">(</span><span class="va">pidfc_nsf</span>, window <span class="op">=</span> <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       h=1       h=2       h=3 </span></span>
<span><span class="co">#&gt; 0.9437500 0.9461153 0.9447236</span></span>
<span><span class="op">(</span><span class="va">pidfc_nsf_wid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/width.html">width</a></span><span class="op">(</span><span class="va">pidfc_nsf</span>, window <span class="op">=</span> <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">95</span>, includemedian <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean width:</span></span>
<span><span class="co">#&gt;      h=1      h=2      h=3 </span></span>
<span><span class="co">#&gt; 4.129826 5.443648 5.878857 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Median width:</span></span>
<span><span class="co">#&gt;      h=1      h=2      h=3 </span></span>
<span><span class="co">#&gt; 4.051401 5.450223 5.748390</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># PID with a Naive method as the scorecaster</span></span>
<span><span class="va">naivefun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">h</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/forecast.rw_model.html" class="external-link">naive</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">h</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">pidfc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pid.html">pid</a></span><span class="op">(</span><span class="va">fc</span>, symmetric <span class="op">=</span> <span class="cn">FALSE</span>, ncal <span class="op">=</span> <span class="fl">100</span>, rolling <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             integrate <span class="op">=</span> <span class="cn">TRUE</span>, scorecast <span class="op">=</span> <span class="cn">TRUE</span>, scorecastfun <span class="op">=</span> <span class="va">naivefun</span>,</span>
<span>             lr <span class="op">=</span> <span class="va">lr</span>, KI <span class="op">=</span> <span class="va">KI</span>, Csat <span class="op">=</span> <span class="va">Csat</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">pidfc_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html" class="external-link">accuracy</a></span><span class="op">(</span><span class="va">pidfc</span>, byhorizon <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Winkler_95  MSIS_95</span></span>
<span><span class="co">#&gt; CV h=1   7.127771 6.889720</span></span>
<span><span class="co">#&gt; CV h=2   9.341393 9.032121</span></span>
<span><span class="co">#&gt; CV h=3  10.042744 9.711128</span></span>
<span><span class="op">(</span><span class="va">pidfc_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coverage.html">coverage</a></span><span class="op">(</span><span class="va">pidfc</span>, window <span class="op">=</span> <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       h=1       h=2       h=3 </span></span>
<span><span class="co">#&gt; 0.9387500 0.9411028 0.9409548</span></span>
<span><span class="op">(</span><span class="va">pidfc_wid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/width.html">width</a></span><span class="op">(</span><span class="va">pidfc</span>, window <span class="op">=</span> <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">95</span>, includemedian <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean width:</span></span>
<span><span class="co">#&gt;      h=1      h=2      h=3 </span></span>
<span><span class="co">#&gt; 6.004732 7.686964 7.618278 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Median width:</span></span>
<span><span class="co">#&gt;      h=1      h=2      h=3 </span></span>
<span><span class="co">#&gt; 5.972480 7.664302 7.656036</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multistep-ahead-conformal-prediction-acmcp">Multistep-ahead conformal prediction (AcMCP)<a class="anchor" aria-label="anchor" href="#multistep-ahead-conformal-prediction-acmcp"></a>
</h3>
<p>Similar to the PID method, the AcMCP method also integrates three
modules (P, I, and D) to form the final iteration. However, instead of
performing conformal prediction for each individual forecast horizon
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
separately, AcMCP employs a combination of an
MA(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">h-1</annotation></semantics></math>)
model and a linear regression model of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>e</mi><mrow><mi>t</mi><mo>+</mo><mi>h</mi><mo stretchy="false" form="prefix">|</mo><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">e_{t+h|t}</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mrow><mi>t</mi><mo>+</mo><mi>h</mi><mo>−</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><mi>t</mi></mrow></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>e</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false" form="prefix">|</mo><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">e_{t+h-1|t},\dots,e_{t+1|t}</annotation></semantics></math>
as the scorecaster. This allows the AcMCP method to capture the
relationship between the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>-step
ahead forecast error and past errors.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acmcpfc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/acmcp.html">acmcp</a></span><span class="op">(</span><span class="va">fc</span>, ncal <span class="op">=</span> <span class="fl">100</span>, rolling <span class="op">=</span> <span class="cn">TRUE</span>, integrate <span class="op">=</span> <span class="cn">TRUE</span>, scorecast <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             lr <span class="op">=</span> <span class="va">lr</span>, KI <span class="op">=</span> <span class="va">KI</span>, Csat <span class="op">=</span> <span class="va">Csat</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">acmcpfc_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html" class="external-link">accuracy</a></span><span class="op">(</span><span class="va">acmcpfc</span>, byhorizon <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Winkler_95  MSIS_95</span></span>
<span><span class="co">#&gt; CV h=1   5.159843 4.984948</span></span>
<span><span class="co">#&gt; CV h=2   6.664827 6.437713</span></span>
<span><span class="co">#&gt; CV h=3   6.904946 6.662531</span></span>
<span><span class="op">(</span><span class="va">acmcpfc_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coverage.html">coverage</a></span><span class="op">(</span><span class="va">acmcpfc</span>, window <span class="op">=</span> <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       h=1       h=2       h=3 </span></span>
<span><span class="co">#&gt; 0.9437500 0.9473684 0.9447236</span></span>
<span><span class="op">(</span><span class="va">acmcpfc_wid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/width.html">width</a></span><span class="op">(</span><span class="va">acmcpfc</span>, window <span class="op">=</span> <span class="fl">100</span>, level <span class="op">=</span> <span class="fl">95</span>, includemedian <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mean width:</span></span>
<span><span class="co">#&gt;      h=1      h=2      h=3 </span></span>
<span><span class="co">#&gt; 4.134144 5.601782 5.796113 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Median width:</span></span>
<span><span class="co">#&gt;      h=1      h=2      h=3 </span></span>
<span><span class="co">#&gt; 4.068763 5.561382 5.562705</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="coverage-and-width-of-prediction-intervals">Coverage and width of prediction intervals<a class="anchor" aria-label="anchor" href="#coverage-and-width-of-prediction-intervals"></a>
</h2>
<p>Taking the AcMCP result as an example, we now show the average
coverage on validation sets.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acmcpfc_cov</span><span class="op">$</span><span class="va">rollmean</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>horizon <span class="op">=</span> <span class="va">key</span>, coverage <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tsibble.tidyverts.org/reference/update_tsibble.html" class="external-link">update_tsibble</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">horizon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">key</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="va">coverage</span>, group <span class="op">=</span> <span class="va">horizon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.95</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">horizon</span><span class="op">~</span><span class="va">.</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Rolling mean coverage for AcMCP"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="conformalForecast_files/figure-html/covplot-1.png" class="r-plt" alt="" width="672"></p>
<p>We can also show the rolling average interval width on validation
sets.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acmcpfc_wid</span><span class="op">$</span><span class="va">rollmean</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>horizon <span class="op">=</span> <span class="va">key</span>, width <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tsibble.tidyverts.org/reference/update_tsibble.html" class="external-link">update_tsibble</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">horizon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">key</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="va">width</span>, group <span class="op">=</span> <span class="va">horizon</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">horizon</span><span class="op">~</span><span class="va">.</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Rolling mean width for AcMCP"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="conformalForecast_files/figure-html/widplot-1.png" class="r-plt" alt="" width="672"></p>
<p>We can also combine all the results and show them in one single
plot.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">candidates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fc"</span>, <span class="st">"scpfc"</span>, <span class="st">"scpfc_exp"</span>, <span class="st">"acpfc"</span>, <span class="st">"pidfc_nsf"</span>, <span class="st">"pidfc"</span>, <span class="st">"acmcpfc"</span><span class="op">)</span></span>
<span><span class="va">methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AR"</span>, <span class="st">"SCP"</span>, <span class="st">"WCP"</span>, <span class="st">"ACP"</span>, <span class="st">"PI"</span>, <span class="st">"PID"</span>, <span class="st">"AcMCP"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">candidates</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">candidates</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"_cov"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out_pivot</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">rollmean</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>horizon <span class="op">=</span> <span class="va">key</span>, coverage <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tsibble.tidyverts.org/reference/update_tsibble.html" class="external-link">update_tsibble</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">horizon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">key</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">methods</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">methods</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"_cov"</span><span class="op">)</span>, <span class="va">out_pivot</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">mget</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">methods</span>, <span class="st">"_cov"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"AR"</span> <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>  <span class="st">"SCP"</span> <span class="op">=</span> <span class="st">"yellow"</span>,</span>
<span>  <span class="st">"WCP"</span> <span class="op">=</span> <span class="st">"#fa9200"</span>,</span>
<span>  <span class="st">"ACP"</span> <span class="op">=</span> <span class="st">"green"</span>,</span>
<span>  <span class="st">"PI"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>  <span class="st">"PID"</span> <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>  <span class="st">"AcMCP"</span> <span class="op">=</span> <span class="st">"red"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cov</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">index</span>, key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">horizon</span>, <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">method</span>, levels <span class="op">=</span> <span class="va">methods</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="va">coverage</span>, group <span class="op">=</span> <span class="va">method</span>, colour <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.8</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.95</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, colour <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">horizon</span><span class="op">~</span><span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Rolling mean coverage"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="conformalForecast_files/figure-html/bind-cov-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">candidates</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">candidates</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"_cov"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">candidates</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"_score"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      method <span class="op">=</span> <span class="va">methods</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>      covmean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">out_cov</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span>,</span>
<span>      winkler <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">out_score</span><span class="op">[</span>, <span class="st">"Winkler_95"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      msis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">out_score</span><span class="op">[</span>,<span class="st">"MSIS_95"</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">"horizon"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>horizon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"h="</span>, <span class="va">horizon</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out_mean</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">cov_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">bind_rows</span>, <span class="va">cov_mean</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">method</span>, levels <span class="op">=</span> <span class="va">methods</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>covdiff <span class="op">=</span> <span class="va">covmean</span> <span class="op">-</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">horizon</span>, <span class="va">method</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cov_mean</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">cov_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 21 × 6</span></span></span>
<span><span class="co">#&gt;    horizon method covmean winkler  msis   covdiff</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> h=1     AR       0.954    4.78  4.66  0.004<span style="text-decoration: underline;">44</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> h=1     SCP      0.95     5.00  4.83  0       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> h=1     WCP      0.955    5.11  4.93  0.005<span style="text-decoration: underline;">00</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> h=1     ACP      0.949    5.04  4.86 -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">25</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> h=1     PI       0.944    5.12  4.95 -<span style="color: #BB0000;">0.006</span><span style="color: #BB0000; text-decoration: underline;">25</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> h=1     PID      0.939    7.13  6.89 -<span style="color: #BB0000;">0.011</span><span style="color: #BB0000; text-decoration: underline;">2</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> h=1     AcMCP    0.944    5.16  4.98 -<span style="color: #BB0000;">0.006</span><span style="color: #BB0000; text-decoration: underline;">25</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> h=2     AR       0.942    6.25  6.09 -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">84</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> h=2     SCP      0.947    6.53  6.30 -<span style="color: #BB0000;">0.002</span><span style="color: #BB0000; text-decoration: underline;">63</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> h=2     WCP      0.955    6.56  6.34  0.004<span style="text-decoration: underline;">89</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> h=2     ACP      0.950    6.64  6.42 -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">125</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> h=2     PI       0.946    6.76  6.53 -<span style="color: #BB0000;">0.003</span><span style="color: #BB0000; text-decoration: underline;">88</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> h=2     PID      0.941    9.34  9.03 -<span style="color: #BB0000;">0.008</span><span style="color: #BB0000; text-decoration: underline;">90</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> h=2     AcMCP    0.947    6.66  6.44 -<span style="color: #BB0000;">0.002</span><span style="color: #BB0000; text-decoration: underline;">63</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> h=3     AR       0.935    6.27  6.11 -<span style="color: #BB0000;">0.014</span><span style="color: #BB0000; text-decoration: underline;">6</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> h=3     SCP      0.940    6.64  6.40 -<span style="color: #BB0000;">0.010</span><span style="color: #BB0000; text-decoration: underline;">3</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> h=3     WCP      0.948    6.62  6.38 -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">51</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> h=3     ACP      0.950    6.79  6.55 -<span style="color: #BB0000;">0.000</span><span style="color: #BB0000; text-decoration: underline;">251</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> h=3     PI       0.945    6.96  6.72 -<span style="color: #BB0000;">0.005</span><span style="color: #BB0000; text-decoration: underline;">28</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> h=3     PID      0.941   10.0   9.71 -<span style="color: #BB0000;">0.009</span><span style="color: #BB0000; text-decoration: underline;">05</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">21</span> h=3     AcMCP    0.945    6.90  6.66 -<span style="color: #BB0000;">0.005</span><span style="color: #BB0000; text-decoration: underline;">28</span></span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">candidates</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">candidates</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"_wid"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out_pivot</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">rollmean</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>horizon <span class="op">=</span> <span class="va">key</span>, width <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tsibble.tidyverts.org/reference/update_tsibble.html" class="external-link">update_tsibble</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">horizon</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">key</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">methods</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">methods</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"_wid"</span><span class="op">)</span>, <span class="va">out_pivot</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">wid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">mget</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">methods</span>, <span class="st">"_wid"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wid</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html" class="external-link">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">index</span>, key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">horizon</span>, <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">method</span>, levels <span class="op">=</span> <span class="va">methods</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">index</span>, y <span class="op">=</span> <span class="va">width</span>, group <span class="op">=</span> <span class="va">method</span>, colour <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.8</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">horizon</span><span class="op">~</span><span class="va">.</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Rolling mean width"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="conformalForecast_files/figure-html/bind-wid-1.png" class="r-plt" alt="" width="672"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Xiaoqian Wang, Rob Hyndman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
