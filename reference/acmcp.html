<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Multistep-ahead conformal prediction method — acmcp • conformalForecast</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multistep-ahead conformal prediction method — acmcp"><meta name="description" content="Compute prediction intervals and other information by applying the
multistep-ahead conformal prediction (AcMCP) method. The method can only
deal with asymmetric nonconformity scores, i.e., forecast errors."><meta property="og:description" content="Compute prediction intervals and other information by applying the
multistep-ahead conformal prediction (AcMCP) method. The method can only
deal with asymmetric nonconformity scores, i.e., forecast errors."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">conformalForecast</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/conformalForecast.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/xqnwang/conformalForecast/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Multistep-ahead conformal prediction method</h1>
      <small class="dont-index">Source: <a href="https://github.com/xqnwang/conformalForecast/blob/main/R/mcp.R" class="external-link"><code>R/mcp.R</code></a></small>
      <div class="d-none name"><code>acmcp.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compute prediction intervals and other information by applying the
multistep-ahead conformal prediction (AcMCP) method. The method can only
deal with asymmetric nonconformity scores, i.e., forecast errors.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">acmcp</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="fl">0.01</span> <span class="op">*</span> <span class="va">object</span><span class="op">$</span><span class="va">level</span>,</span>
<span>  ncal <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  rolling <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  integrate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scorecast <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  lr <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  Tg <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  delta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Csat <span class="op">=</span> <span class="fl">2</span><span class="op">/</span><span class="va">pi</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Tg</span><span class="op">)</span> <span class="op">*</span> <span class="va">delta</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Tg</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  KI <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">object</span><span class="op">$</span><span class="va">errors</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>An object of class <code>"cvforecast"</code>. It must have an argument
<code>x</code> for original univariate time series, an argument <code>MEAN</code> for
point forecasts and <code>ERROR</code> for forecast errors on validation set.
See the results of a call to <code><a href="cvforecast.html">cvforecast</a></code>.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>A numeric vector of significance levels to achieve a desired
coverage level \(1-\alpha\).</p></dd>


<dt id="arg-ncal">ncal<a class="anchor" aria-label="anchor" href="#arg-ncal"></a></dt>
<dd><p>Length of the burn-in period for training the scorecaster.
If <code>rolling = TRUE</code>, it is also used as the length of the trailing windows
for learning rate calculation and the windows for the calibration set.
If <code>rolling = FALSE</code>, it is used as the initial period of calibration sets
and trailing windows for learning rate calculation.</p></dd>


<dt id="arg-rolling">rolling<a class="anchor" aria-label="anchor" href="#arg-rolling"></a></dt>
<dd><p>If <code>TRUE</code>, a rolling window strategy will be adopted to
form the trailing window for learning rate calculation and the calibration set
for scorecaster if applicable. Otherwise, expanding window strategy will be used.</p></dd>


<dt id="arg-integrate">integrate<a class="anchor" aria-label="anchor" href="#arg-integrate"></a></dt>
<dd><p>If <code>TRUE</code>, error integration will be included in the
update process.</p></dd>


<dt id="arg-scorecast">scorecast<a class="anchor" aria-label="anchor" href="#arg-scorecast"></a></dt>
<dd><p>If <code>TRUE</code>, scorecasting will be included in the update
process.</p></dd>


<dt id="arg-lr">lr<a class="anchor" aria-label="anchor" href="#arg-lr"></a></dt>
<dd><p>Initial learning rate used for quantile tracking.</p></dd>


<dt id="arg-tg">Tg<a class="anchor" aria-label="anchor" href="#arg-tg"></a></dt>
<dd><p>The time that is set to achieve the target absolute coverage
guarantee before this.</p></dd>


<dt id="arg-delta">delta<a class="anchor" aria-label="anchor" href="#arg-delta"></a></dt>
<dd><p>The target absolute coverage guarantee is set to \(1-\alpha-\delta\).</p></dd>


<dt id="arg-csat">Csat<a class="anchor" aria-label="anchor" href="#arg-csat"></a></dt>
<dd><p>A positive constant ensuring that by time <code>Tg</code>, an absolute
guarantee is of at least \(1-\alpha-\delta\) coverage.</p></dd>


<dt id="arg-ki">KI<a class="anchor" aria-label="anchor" href="#arg-ki"></a></dt>
<dd><p>A positive constant to place the integrator on the same scale as the scores.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other arguments are passed to the function.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of class <code>c("acmcp", "cpforecast", "forecast")</code>
with the following components:</p>
<dl><dt>x</dt>
<dd><p>The original time series.</p></dd>

<dt>series</dt>
<dd><p>The name of the series <code>x</code>.</p></dd>

<dt>method</dt>
<dd><p>A character string "acmcp".</p></dd>

<dt>cp_times</dt>
<dd><p>The number of times the conformal prediction is performed in
cross-validation.</p></dd>

<dt>MEAN</dt>
<dd><p>Point forecasts as a multivariate time series, where the \(h\)th column
holds the point forecasts for forecast horizon \(h\). The time index
corresponds to the period for which the forecast is produced.</p></dd>

<dt>ERROR</dt>
<dd><p>Forecast errors given by
\(e_{t+h|t} = y_{t+h}-\hat{y}_{t+h|t}\).</p></dd>

<dt>LOWER</dt>
<dd><p>A list containing lower bounds for prediction intervals for
each <code>level</code>. Each element within the list will be a multivariate time
series with the same dimensional characteristics as <code>MEAN</code>.</p></dd>

<dt>UPPER</dt>
<dd><p>A list containing upper bounds for prediction intervals for
each <code>level</code>. Each element within the list will be a multivariate time
series with the same dimensional characteristics as <code>MEAN</code>.</p></dd>

<dt>level</dt>
<dd><p>The confidence values associated with the prediction intervals.</p></dd>

<dt>call</dt>
<dd><p>The matched call.</p></dd>

<dt>model</dt>
<dd><p>A list containing information abouth the conformal prediction model.</p></dd>

</dl><p>If <code>mean</code> is included in the <code>object</code>, the components <code>mean</code>,
<code>lower</code>, and <code>upper</code> will also be returned, showing the information
about the test set forecasts generated using all available observations.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Similar to the PID method, the AcMCP method also integrates three modules (P, I, and D) to
form the final iteration. However, instead of performing conformal prediction
for each individual forecast horizon <code>h</code> separately, AcMCP employs a combination
of an MA\((h-1)\) model and a linear regression model of \(e_{t+h|t}\) on
\(e_{t+h-1|t},\dots,e_{t+1|t}\) as the scorecaster. This allows the AcMCP method
to capture the relationship between the \(h\)-step ahead forecast error and
past errors.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Wang, X., and Hyndman, R. J. (2024). "Online conformal inference
for multi-step time series forecasting", arXiv preprint arXiv:2410.13115.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="pid.html">pid</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Simulate time series from an AR(2) model</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pkg.robjhyndman.com/forecast/" class="external-link">forecast</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/arima.sim.html" class="external-link">arima.sim</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Cross-validation forecasting</span></span></span>
<span class="r-in"><span><span class="va">far2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">h</span>, <span class="va">level</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://pkg.robjhyndman.com/forecast/reference/Arima.html" class="external-link">Arima</a></span><span class="op">(</span><span class="va">x</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html" class="external-link">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">h</span>, <span class="va">level</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">fc</span> <span class="op">&lt;-</span> <span class="fu"><a href="cvforecast.html">cvforecast</a></span><span class="op">(</span><span class="va">series</span>, forecastfun <span class="op">=</span> <span class="va">far2</span>, h <span class="op">=</span> <span class="fl">3</span>, level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">95</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 forward <span class="op">=</span> <span class="cn">TRUE</span>, initial <span class="op">=</span> <span class="fl">1</span>, window <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># AcMCP setup</span></span></span>
<span class="r-in"><span><span class="va">Tg</span> <span class="op">&lt;-</span> <span class="fl">1000</span>; <span class="va">delta</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span></span>
<span class="r-in"><span><span class="va">Csat</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">/</span> <span class="va">pi</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Tg</span><span class="op">)</span> <span class="op">*</span> <span class="va">delta</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Tg</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">KI</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">lr</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># AcMCP with integrator and scorecaster</span></span></span>
<span class="r-in"><span><span class="va">acmcpfc</span> <span class="op">&lt;-</span> <span class="fu">acmcp</span><span class="op">(</span><span class="va">fc</span>, ncal <span class="op">=</span> <span class="fl">100</span>, rolling <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>             integrate <span class="op">=</span> <span class="cn">TRUE</span>, scorecast <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>             lr <span class="op">=</span> <span class="va">lr</span>, KI <span class="op">=</span> <span class="va">KI</span>, Csat <span class="op">=</span> <span class="va">Csat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">acmcpfc</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ACMCP </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  acmcp(object = fc, ncal = 100, rolling = TRUE, integrate = TRUE,  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      scorecast = TRUE, lr = lr, Csat = Csat, KI = KI) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  cp_times = 898 (the forward step included) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Forecasts of the forward step:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Point Forecast     Lo 80    Hi 80     Lo 95    Hi 95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1001      1.0539540 -0.117430 2.471852 -1.536370 2.690396</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1002      0.5349292 -1.903078 2.607889 -1.839942 2.809043</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1003     -0.1518494 -2.246962 1.546510 -2.563097 2.295852</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">acmcpfc</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ACMCP </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  acmcp(object = fc, ncal = 100, rolling = TRUE, integrate = TRUE,  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      scorecast = TRUE, lr = lr, Csat = Csat, KI = KI) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  cp_times = 898 (the forward step included) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Forecasts of the forward step:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Point Forecast     Lo 80    Hi 80     Lo 95    Hi 95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1001      1.0539540 -0.117430 2.471852 -1.536370 2.690396</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1002      0.5349292 -1.903078 2.607889 -1.839942 2.809043</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1003     -0.1518494 -2.246962 1.546510 -2.563097 2.295852</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cross-validation error measures:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      ME   MAE   MSE  RMSE     MPE    MAPE  MASE RMSSE Winkler_95 MSIS_95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CV 0.01 0.922 1.339 1.035 187.692 359.329 0.898 0.815      5.833   5.717</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Xiaoqian Wang, Rob Hyndman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

